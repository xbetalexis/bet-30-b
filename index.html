<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP Gold Scratch - Bet30</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bet-pink: #ff0055;
            --bet-gold: #ffcc00;
            --neon-glow: 0 0 20px rgba(255, 0, 85, 0.6);
        }

        body, html {
            margin: 0; padding: 0;
            height: 100%; width: 100%;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            background: #000;
        }

        /* FONDO DE IMAGEN CASINO REAL */
        .casino-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://images.unsplash.com/photo-1596838132731-3301c3fd4317?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            filter: brightness(0.4) blur(4px);
            z-index: -1;
            transform: scale(1.1); /* Evita bordes blancos por el blur */
        }

        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 30%, rgba(0,0,0,0.8) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }

        /* HEADER */
        .brand-header {
            text-align: center;
            margin-bottom: 30px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .brand-header h1 {
            font-size: 55px;
            color: #fff;
            margin: 0;
            text-shadow: 0 0 15px var(--bet-pink);
            font-style: italic;
            font-weight: 900;
        }

        /* RASPADITA OPTIMIZADA */
        .scratch-card {
            position: relative;
            width: 380px;
            height: 200px;
            border-radius: 20px;
            border: 4px solid var(--bet-gold);
            box-shadow: 0 0 40px rgba(255, 0, 85, 0.5);
            background: #111;
            overflow: hidden;
        }

        .prize-content {
            position: absolute;
            width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: url('https://www.transparenttextures.com/patterns/dark-leather.png');
            text-align: center;
        }

        .prize-content h2 { color: #444; font-size: 20px; text-transform: uppercase; }
        .win-value { 
            color: var(--bet-gold); 
            font-size: 50px; 
            font-weight: 900; 
            display: none; 
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
        }

        #canvas {
            position: absolute;
            top: 0; left: 0;
            z-index: 10;
            cursor: crosshair;
            touch-action: none; /* Crucial para móviles */
        }

        /* MODAL GANADOR */
        #winModal {
            display: none;
            position: fixed;
            top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .win-box {
            background: linear-gradient(135deg, #1a1a1a 0%, #000 100%);
            padding: 50px;
            border-radius: 30px;
            border: 3px solid var(--bet-gold);
            text-align: center;
            box-shadow: 0 0 60px var(--bet-pink);
        }

        .win-box h1 { font-size: 70px; color: #fff; margin: 10px 0; }
        .win-box button {
            background: var(--bet-gold);
            color: #000; border: none; padding: 15px 40px;
            border-radius: 10px; font-weight: 900; cursor: pointer;
            margin-top: 20px; font-size: 18px;
        }
    </style>
</head>
<body>

    <div class="casino-bg"></div>

    <div class="overlay">
        <div class="brand-header">
            <h1>BET<span>30</span> VIP</h1>
            <p style="color: var(--bet-gold); font-weight: bold; letter-spacing: 2px;">PREMIO EXCLUSIVO</p>
        </div>

        <div class="scratch-card">
            <div class="prize-content">
                <h2 id="msg">¡SIGUE RASPANDO!</h2>
                <div class="win-value" id="val">5.000</div>
            </div>
            <canvas id="canvas" width="380" height="200"></canvas>
        </div>
    </div>

    <div id="winModal">
        <div class="win-box">
            <h3 style="color:var(--bet-pink); margin:0;">JACKPOT!</h3>
            <h1>5.000</h1>
            <p style="color:var(--bet-gold)">FICHAS NO EXTRAÍBLES</p>
            <button onclick="closeWin()">COBRAR PREMIO</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const val = document.getElementById('val');
        const msg = document.getElementById('msg');
        const winModal = document.getElementById('winModal');

        let attempts = 0;
        let isDrawing = false;

        function init() {
            // Capa gris metalizada premium
            const grad = ctx.createLinearGradient(0,0,380,200);
            grad.addColorStop(0, '#444');
            grad.addColorStop(0.5, '#888');
            grad.addColorStop(1, '#333');
            ctx.fillStyle = grad;
            ctx.fillRect(0,0,380,200);

            // Texto de ayuda
            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = "rgba(255,255,255,0.5)";
            ctx.font = "bold 20px Arial";
            ctx.textAlign = "center";
            ctx.fillText("RASPA RÁPIDO AQUÍ", 190, 110);

            ctx.globalCompositeOperation = 'destination-out';
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            ctx.lineWidth = 45; // Raspa más área por cada movimiento
        }

        function scratch(e) {
            if(!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;

            ctx.beginPath();
            // Usamos moveTo/lineTo para que el raspado sea continuo y no deje huecos
            if (this.lastX && this.lastY) {
                ctx.moveTo(this.lastX, this.lastY);
                ctx.lineTo(x, y);
            } else {
                ctx.moveTo(x, y);
                ctx.lineTo(x, y);
            }
            ctx.stroke();
            
            this.lastX = x;
            this.lastY = y;

            checkProgress();
        }

        function checkProgress() {
            // Verificamos el progreso solo cada ciertos movimientos para no saturar
            const data = ctx.getImageData(0,0,380,200).data;
            let count = 0;
            for(let i=3; i<data.length; i+=40) if(data[i] === 0) count++;
            
            // Si se raspó el 40%, revelamos
            if(count > 150) reveal();
        }

        function reveal() {
            if (!isDrawing) return;
            isDrawing = false;
            attempts++;

            if(attempts === 20) {
                msg.style.display = 'none';
                val.style.display = 'block';
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                setTimeout(() => { winModal.style.display = 'flex'; }, 800);
            } else {
                setTimeout(() => {
                    alert("¡Casi lo tienes! Intenta de nuevo.");
                    reset();
                }, 300);
            }
        }

        function reset() {
            this.lastX = null;
            this.lastY = null;
            ctx.globalCompositeOperation = 'source-over';
            init();
            val.style.display = 'none';
            msg.style.display = 'block';
        }

        function closeWin() {
            attempts = 0;
            winModal.style.display = 'none';
            reset();
        }

        canvas.addEventListener('mousedown', (e) => { isDrawing = true; scratch(e); });
        canvas.addEventListener('touchstart', (e) => { isDrawing = true; scratch(e); });
        window.addEventListener('mouseup', () => { isDrawing = false; this.lastX = null; });
        window.addEventListener('touchend', () => { isDrawing = false; this.lastX = null; });
        canvas.addEventListener('mousemove', scratch);
        canvas.addEventListener('touchmove', (e) => { e.preventDefault(); scratch(e); }, {passive: false});

        init();
    </script>
</body>
</html>
