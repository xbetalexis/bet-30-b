<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Bet30 VIP - Raspadita Premium</title>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
:root{--gold:#d4af37;--pink:#ff3399;}

html,body{
    margin:0;
    height:100%;
    font-family:'Segoe UI',sans-serif;
    background:#000;
    overflow:hidden;
    overscroll-behavior:none;
    touch-action:none;
}

/* FONDO CASINO */
.background{
    position:fixed;
    inset:0;
    background:url('https://images.unsplash.com/photo-1606166325683-e1e2e6a3b7fa?q=80&w=2070') center/cover no-repeat;
    filter:brightness(.35);
    z-index:-1;
}

/* GANADORES */
.top-winners{
    position:absolute;
    top:0;
    width:100%;
    background:rgba(0,0,0,.85);
    border-bottom:1px solid var(--gold);
    padding:10px;
    color:#f1c40f;
    display:flex;
    justify-content:center;
    gap:25px;
    font-size:13px;
    font-weight:700;
    z-index:10;
}

/* CONTENEDOR */
.main-container{
    height:100vh;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
}

/* LOGO */
.logo-area{text-align:center;margin-bottom:30px;}
.logo-area h1{
    color:#fff;
    font-size:60px;
    font-weight:900;
    margin:0;
}
.logo-area h1 span{color:var(--pink);font-style:italic;font-weight:300;}
.logo-area p{color:var(--gold);letter-spacing:5px;font-weight:700;}

/* TARJETA */
.card-frame{
    padding:12px;
    background:#1a1a1a;
    border:3px solid var(--gold);
    border-radius:40px;
    box-shadow:0 0 40px var(--pink);
    width:480px;
    height:260px;
    max-width:90vw;
}

.card-inner{
    width:100%;
    height:100%;
    border-radius:30px;
    background:#000 url('https://www.transparenttextures.com/patterns/dark-leather.png');
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
    overflow:hidden;
}

.prize-value{
    color:var(--gold);
    font-size:80px;
    font-weight:900;
}

#scratch-canvas{
    position:absolute;
    inset:0;
    cursor:crosshair;
    touch-action:none;
}

/* MODALES */
#win-modal,#block-modal{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.95);
    z-index:100;
    justify-content:center;
    align-items:center;
}

.modal-content{
    background:#111;
    border:2px solid var(--gold);
    border-radius:30px;
    padding:45px;
    text-align:center;
    box-shadow:0 0 60px var(--pink);
}

.modal-content h2{color:var(--pink);font-size:36px;}
.modal-content .big-num{color:#fff;font-size:75px;font-weight:900;}
.modal-content p{color:var(--gold);font-size:16px;}
</style>
</head>

<body>

<div class="background"></div>

<div class="top-winners">
<span>★ LucasM ganó $2.500</span>
<span>★ Nico88 ganó $5.000</span>
<span>★ MatiG ganó $5.000</span>
<span>★ FerPlay ganó $2.500</span>
</div>

<div class="main-container">
<div class="logo-area">
<h1>BET30 <span>VIP</span></h1>
<p>PREMIO EXCLUSIVO</p>
</div>

<div class="card-frame">
<div class="card-inner">
<div class="prize-value" id="prizeText"></div>
<canvas id="scratch-canvas" width="480" height="260"></canvas>
</div>
</div>
</div>

<div id="win-modal">
<div class="modal-content">
<h2>¡GANASTE!</h2>
<div class="big-num">5.000</div>
<p id="winInfo"></p>
</div>
</div>

<div id="block-modal">
<div class="modal-content">
<h2>LÍMITE ALCANZADO</h2>
<p>Ya usaste tus 3 intentos.<br>Volvé más tarde.</p>
</div>
</div>

<script>
const MAX_INTENTOS = 3;
const STORAGE_KEY = "bet30_raspadita";

let data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
    intentos:0,
    ganador:false,
    codigo:null,
    fecha:null
};

const canvas = document.getElementById("scratch-canvas");
const ctx = canvas.getContext("2d");
const prizeText = document.getElementById("prizeText");
const winModal = document.getElementById("win-modal");
const blockModal = document.getElementById("block-modal");
const winInfo = document.getElementById("winInfo");

if(data.intentos >= MAX_INTENTOS){
    blockModal.style.display="flex";
    canvas.style.display="none";
}

const hasPrize = data.ganador || (!data.ganador && Math.floor(Math.random()*20)===0);
prizeText.innerText = hasPrize ? "5.000" : "SIN PREMIO";

function init(){
    ctx.globalCompositeOperation="source-over";
    ctx.fillStyle="#bfc3c7";
    ctx.fillRect(0,0,480,260);
    ctx.fillStyle="rgba(0,0,0,.35)";
    ctx.font="bold 32px Arial";
    ctx.textAlign="center";
    ctx.fillText("RASPA AQUÍ",240,145);
    ctx.globalCompositeOperation="destination-out";
    ctx.lineWidth=45;
    ctx.lineCap="round";
}

let drawing=false,lastX=null,lastY=null,finished=false;

function scratch(e){
    if(!drawing||finished) return;
    const r=canvas.getBoundingClientRect();
    const x=(e.clientX||e.touches[0].clientX)-r.left;
    const y=(e.clientY||e.touches[0].clientY)-r.top;
    ctx.beginPath();
    ctx.moveTo(lastX||x,lastY||y);
    ctx.lineTo(x,y);
    ctx.stroke();
    lastX=x;lastY=y;
    check();
}

function check(){
    const img=ctx.getImageData(0,0,480,260).data;
    let clear=0;
    for(let i=3;i<img.length;i+=4) if(img[i]===0) clear++;
    if(clear/(img.length/4)>=0.6){
        finished=true;
        reveal();
    }
}

function reveal(){
    data.intentos++;
    localStorage.setItem(STORAGE_KEY,JSON.stringify(data));
    canvas.style.opacity=0;

    if(hasPrize && !data.ganador){
        data.ganador=true;
        data.codigo=genCode();
        data.fecha=new Date().toLocaleString("es-AR");
        localStorage.setItem(STORAGE_KEY,JSON.stringify(data));
        confetti({particleCount:300,spread:120,origin:{y:.6}});
        winInfo.innerHTML=`FICHAS NO EXTRAÍBLES<br><br>
        <b>Fecha:</b> ${data.fecha}<br>
        <b>Código:</b> ${data.codigo}`;
        winModal.style.display="flex";
    }else{
        alert("No hubo premio esta vez.");
        if(data.intentos>=MAX_INTENTOS) blockModal.style.display="flex";
    }
}

function genCode(){
    const l="ABCDEFGHIJKLMNOPQRSTUVWXYZ",n="0123456789";
    let c="";
    for(let i=0;i<4;i++) c+=l[Math.floor(Math.random()*l.length)];
    for(let i=0;i<3;i++) c+=n[Math.floor(Math.random()*n.length)];
    return c;
}

/* EVENTOS PC */
canvas.addEventListener("mousedown",e=>{drawing=true;scratch(e);});
canvas.addEventListener("mousemove",scratch);
window.addEventListener("mouseup",()=>{drawing=false;lastX=null;});

/* EVENTOS MOBILE FIX */
canvas.addEventListener("touchstart",e=>{
    e.preventDefault();
    drawing=true;
    scratch(e);
},{passive:false});

canvas.addEventListener("touchmove",e=>{
    e.preventDefault();
    scratch(e);
},{passive:false});

canvas.addEventListener("touchend",e=>{
    e.preventDefault();
    drawing=false;
    lastX=null;lastY=null;
},{passive:false});

init();
</script>

</body>
</html>
